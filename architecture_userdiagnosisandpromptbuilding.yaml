architecture: Unified AI Assistant Window with Three-Column Layout
version: 3.0.0
status: design_ready_for_implementation
purpose: |
  Transform AIAssistantWindow into a three-column layout with:
  - Left: AI Conversation (shared across all workflows)
  - Middle: Prompt Library Browser (always visible, collapsible)
  - Right: Preview/Edit Pane

  Supports two operational modes:
  1. Scene Builder Mode (default) - Natural language scene building
  2. Example Mode (temporary) - Create/refine prompt library examples

  All system instructions moved from hardcoded ContextBuilder to prompt files.

design_principles:
  - Single conversation: One chat log for all workflows (Scene Builder + Example Mode)
  - Three-column layout: Conversation | Prompt Library | Preview (always visible)
  - Modal Example Mode: Temporary workflow for creating examples, auto-exits on completion
  - Prompt-based instructions: All system messages loaded from prompt library files
  - State serialization: Unity 6 compatible serialization for domain reload survival

overview: |
  This architecture replaces the hardcoded system message in ContextBuilder with
  a flexible prompt library system, and adds a three-column UI for creating and
  refining prompt examples through conversational AI interaction.

  Key Features:
  - Three columns: Conversation (40%) | Prompt Library (30%) | Preview (30%)
  - Prompt Library always visible with enable/disable checkboxes
  - "Create New Example" and "Refine Selected" buttons
  - Example Mode: Temporary workflow (enter → work → save → exit)
  - Context toggles: Send scene / Send prefab catalog checkboxes
  - All instructions in .txt files (user-editable)

components:

  # ============================================================================
  # 0. TOOL DEFINITIONS
  # ============================================================================

  tool_definitions:
    overview: |
      6 total tools provided to AI for scene building and example management:
      1. instantiateObjects - Batch object creation from prefab catalog
      2. modifyGameObject - Modify transforms/components of existing objects
      3. deleteGameObject - Delete objects from scene
      4. addComponent - Add Unity components to objects
      5. removeComponent - Remove Unity components from objects
      6. savePromptFile - Save/update prompt library teaching examples (NEW for Example Mode)

    savePromptFile_tool:
      description: |
        Allows AI to autonomously save or replace prompt library teaching examples.
        Used in Example Mode for diagnostic and refinement workflows.
        AI calls this tool directly - no user "save" commands needed.

      json_schema: |
        {
          "type": "function",
          "name": "savePromptFile",
          "description": "Save or update a prompt library file. Use this to create new teaching examples or fix incorrect existing examples.",
          "parameters": {
            "type": "object",
            "properties": {
              "relativePath": {
                "type": "string",
                "description": "Relative path in PromptLibrary (e.g., 'Examples/Furniture/lamp_on_table.txt')"
              },
              "content": {
                "type": "string",
                "description": "Full content of the prompt file with proper SLS example format"
              },
              "reason": {
                "type": "string",
                "description": "Explanation of what was corrected or why this example was created"
              }
            },
            "required": ["relativePath", "content", "reason"]
          }
        }

  # ============================================================================
  # 1. THREE-COLUMN LAYOUT STRUCTURE
  # ============================================================================

  layout_structure:
    overview: |
      ┌──────────────────┬──────────────────┬──────────────────┐
      │  CONVERSATION    │  PROMPT LIBRARY  │  PREVIEW / EDIT  │
      │  (40% width)     │  (30% width)     │  (30% width)     │
      ├──────────────────┼──────────────────┼──────────────────┤
      │                  │                  │                  │
      │  Chat Log        │  Tree View       │  Selected Prompt │
      │  (scrollable)    │  ☑ Core/         │  Content         │
      │                  │    ☑ basic_...   │  (read-only)     │
      │  [User Input]    │    ☑ sls_det...  │                  │
      │  [Submit]        │  ☑ Examples/     │  OR              │
      │                  │    ☑ Furniture/  │                  │
      │  Settings:       │  ──────────────  │  Example Being   │
      │  ☐ Send scene    │  New Example:    │  Worked On       │
      │  ☐ Send prefabs  │  [name____]      │  (in Example     │
      │                  │  [Create New]    │   Mode)          │
      │  [Exit Example   │  [Refine Sel]    │                  │
      │   Mode] (grey)   │                  │                  │
      │                  │                  │                  │
      └──────────────────┴──────────────────┴──────────────────┘

    left_column:
      width: 40%
      components:
        - Chat log (scrollable conversation history)
        - Prompt input field (60px height)
        - Submit button (Ctrl+Enter shortcut)
        - |
          Settings section:
          - "Send scene context" checkbox
          - "Send prefab catalog" checkbox
        - "Exit Example Mode" button (greyed out when in Scene Builder mode)

    middle_column:
      width: 30%
      components:
        - |
          Tree view (70% of column height):
          - Folder hierarchy with checkboxes
          - Enable/disable prompts
          - Select for preview
        - |
          Bottom section (30% of column height):
          - Text field for new example name
          - "Create New Example" button
          - "Refine Selected Example" button (disabled if no selection)

    right_column:
      width: 30%
      components:
        - Preview pane (read-only TEXT display of prompt file contents)
        - Shows selected prompt content from tree
        - OR shows example being worked on (in Example Mode)
        - NOTE: This is NOT Unity scene/prefab preview - just text content

  # ============================================================================
  # 2. MODE SYSTEM (TEMPORARY EXAMPLE MODE)
  # ============================================================================

  mode_system:
    enum_definition: |
      public enum WindowMode
      {
          SceneBuilder,
          ExampleBuilder
      }

    modes:
      scene_builder:
        description: Default mode for natural language scene building
        persistent: true (always accessible)
        conversation: Each mode maintains its own response ID and log

      example_mode:
        description: Temporary workflow for creating/refining examples
        persistent: false (modal workflow)
        entry_triggers:
          - Click "Create New Example" button
          - Click "Refine Selected Example" button
        exit_triggers:
          - Click "Exit Example Mode" button
          - (Does NOT auto-exit on save - user can save multiple times)
        conversation: Each mode maintains its own response ID and log

    state_management: |
      // Unity 6 serializable state (survives domain reload)
      [System.Serializable]
      public class ModeState
      {
          public WindowMode mode;
          public string responseId;
          public List<string> logs = new List<string>();
          public string prompt = "";
          public Vector2 scrollPosition;
      }

      [SerializeField] private List<ModeState> _modeStates = new List<ModeState>();
      [SerializeField] private bool _isExampleMode = false;
      [SerializeField] private string _newExampleName = "";
      [SerializeField] private string _selectedPromptPath = "";

      // Helper properties with null safety
      private ModeState CurrentState
      {
          get
          {
              var mode = _isExampleMode ? WindowMode.ExampleBuilder : WindowMode.SceneBuilder;
              var state = _modeStates.Find(s => s.mode == mode);

              if (state == null)
              {
                  Debug.LogError($"[AI Assistant] Mode state not found for {mode}. Reinitializing.");
                  state = new ModeState { mode = mode };
                  _modeStates.Add(state);
              }

              return state;
          }
      }

      private string CurrentResponseId
      {
          get => CurrentState?.responseId;
          set { if (CurrentState != null) CurrentState.responseId = value; }
      }

      private List<string> CurrentLog => CurrentState?.logs ?? new List<string>();

    log_management: |
      void AppendLog(string message, LogType type, Color color)
      {
          string timestamp = DateTime.Now.ToString("HH:mm:ss");
          CurrentLog.Add($"[{timestamp}] {message}");

          // Limit to 1000 entries to prevent unbounded growth
          if (CurrentLog.Count > 1000)
          {
              CurrentLog.RemoveRange(0, 100); // Remove oldest 100 entries
              CurrentLog.Insert(0, "[System] (Log trimmed - oldest entries removed)");
          }

          Repaint();
      }

    mode_transitions:
      enter_example_mode: |
        void OnCreateNewExample()
        {
            if (string.IsNullOrWhiteSpace(_newExampleName))
            {
                EditorUtility.DisplayDialog("Error", "Enter example name first", "OK");
                return;
            }

            EnterExampleMode(null); // null = creating new
        }

        void OnRefineSelectedExample()
        {
            if (string.IsNullOrEmpty(_selectedPromptPath))
            {
                EditorUtility.DisplayDialog("Error", "Select a prompt first", "OK");
                return;
            }

            EnterExampleMode(_selectedPromptPath); // pass selected file
        }

        void EnterExampleMode(string existingPromptPath)
        {
            _isExampleMode = true;

            // Auto-enable Example Mode prompts
            AutoEnableExampleModePrompts();

            // Log transition with color
            AppendLog("→ Entering example mode", LogType.System, Color.cyan);

            // If refining, load existing content
            if (existingPromptPath != null)
            {
                string content = File.ReadAllText(PromptLibraryLoader.GetFullPath(existingPromptPath));
                // Display in preview pane for editing
            }

            Repaint();
        }

      exit_example_mode: |
        void OnExitExampleMode()
        {
            AppendLog("→ Returning to scene builder mode", LogType.System, Color.cyan);

            _isExampleMode = false;

            // Restore Scene Builder prompts
            AutoEnableSceneBuilderPrompts();

            // Refresh prompt library (in case new example was saved)
            RefreshPromptList();

            Repaint();
        }

  # ============================================================================
  # 3. PROMPT-BASED SYSTEM MESSAGES
  # ============================================================================

  prompt_system:
    purpose: |
      Move all hardcoded instructions from ContextBuilder.cs to editable .txt files.
      Users can view, edit, and manage system instructions through the prompt library.

    core_prompts:
      basic_instructions:
        path: PromptLibrary/Core/basic_instructions.txt
        source: Extract from ContextBuilder.cs (lines 312-600)
        content: All Scene Builder instructions (placement rules, collision detection, etc.)
        auto_enabled: Scene Builder mode (default)

      sls_detailed_guide:
        path: PromptLibrary/Core/sls_detailed_guide.txt
        source: Move from SLS_MATH_README.md
        content: Comprehensive SLS methodology with examples
        auto_enabled: Example Mode

      example_generation_instructions:
        path: PromptLibrary/Core/example_generation_instructions.txt
        source: New file (create from template below)
        content: Instructions for generating Step 0-5 format examples
        auto_enabled: Example Mode

      debug_guide:
        path: PromptLibrary/Diagnostics/debug_guide.txt
        source: New file (create from template below)
        content: Instructions for diagnosing placement errors
        auto_enabled: When user reports error in Example Mode

    prompt_file_templates:
      example_generation_instructions_content: |
        # Example Generation Instructions

        You are creating teaching examples for the prompt library.
        Examples demonstrate correct SLS methodology step-by-step.

        ## Required Structure:
        - Title: EXAMPLE: {description}
        - Goal: Clear statement of objective
        - Step 0: WRITE DOWN metadata (scale, R_ls, semantic points)
        - Steps 1-5: SLS transformations with calculations
        - OUTPUT: position, rotation, scale
        - KEY TAKEAWAYS: Educational notes

        ## Critical Requirements:
        - Use quaternions [x,y,z,w] (NEVER Euler angles)
        - Show R_ls transformation explicitly
        - Include verification calculations
        - Format as markdown with clear sections

      debug_guide_content: |
        # Diagnostic Guide

        When user reports placement errors, follow this process:

        ## 1. Analyze Error Description
        - Identify symptoms (floating, tilted, wrong position)
        - Map symptoms to likely causes

        ## 2. Review Calculation Steps
        - Check Step 0 metadata (correct scale/R_ls?)
        - Verify Step 1 SLS transform
        - Check Step 2 alignment quaternions
        - Validate Step 4 position calculation

        ## 3. Provide Corrected Example
        - Explain what was wrong
        - Show corrected calculation
        - Provide complete corrected Steps 0-5

    auto_enable_logic: |
      void AutoEnableSceneBuilderPrompts()
      {
          var settings = PromptLibrarySettings.GetOrCreateSettings();

          TryEnablePrompt(settings, "PromptLibrary/Core/basic_instructions.txt");
          TryDisablePrompt(settings, "PromptLibrary/Core/sls_detailed_guide.txt");
          TryDisablePrompt(settings, "PromptLibrary/Core/example_generation_instructions.txt");
          TryDisablePrompt(settings, "PromptLibrary/Diagnostics/debug_guide.txt");
      }

      void AutoEnableExampleModePrompts()
      {
          var settings = PromptLibrarySettings.GetOrCreateSettings();

          TryEnablePrompt(settings, "PromptLibrary/Core/sls_detailed_guide.txt");
          TryEnablePrompt(settings, "PromptLibrary/Core/example_generation_instructions.txt");
          TryEnablePrompt(settings, "PromptLibrary/Examples/Core/wall_at_edge.txt");
          TryEnablePrompt(settings, "PromptLibrary/Examples/Furniture/book_on_shelf.txt");
          TryEnablePrompt(settings, "PromptLibrary/Examples/Walls/wall_consistency.txt");
      }

      void AutoEnableDebugGuide()
      {
          var settings = PromptLibrarySettings.GetOrCreateSettings();
          TryEnablePrompt(settings, "PromptLibrary/Diagnostics/debug_guide.txt");
      }

      void TryEnablePrompt(PromptLibrarySettings settings, string path)
      {
          string fullPath = PromptLibraryLoader.GetFullPath(path);
          if (File.Exists(fullPath))
              settings.SetPromptEnabled(path, true);
          else
              Debug.LogWarning($"[AI Assistant] Prompt not found: {path}");
      }

      void TryDisablePrompt(PromptLibrarySettings settings, string path)
      {
          string fullPath = PromptLibraryLoader.GetFullPath(path);
          if (File.Exists(fullPath))
              settings.SetPromptEnabled(path, false);
      }

    context_builder_refactor: |
      // ContextBuilder.cs - Replace hardcoded system message
      // NOTE: Keep return type as 'string' (user message), not ContextPack
      public static string BuildContextPack(
          string userPrompt,
          int tokenBudget,
          out string systemMessage,
          out string toolsJson,
          bool includeSceneContext = true,
          bool includePrefabCatalog = true)
      {
          // Load enabled prompts from library
          var promptSettings = PromptLibrarySettings.GetOrCreateSettings();
          string libraryPrompts = PromptLibraryLoader.LoadEnabledPrompts(promptSettings);

          // Build system message
          StringBuilder sysSb = new StringBuilder();
          sysSb.AppendLine(libraryPrompts); // Inject prompts (replaces hardcoded text)

          // Build user message with context (if enabled)
          StringBuilder userSb = new StringBuilder();

          if (includeSceneContext || includePrefabCatalog)
          {
              userSb.AppendLine("## Current Context");

              if (includeSceneContext)
              {
                  userSb.AppendLine("### Scene State");
                  userSb.AppendLine(GetSceneContext());
              }

              if (includePrefabCatalog)
              {
                  userSb.AppendLine("### Available Prefabs");
                  userSb.AppendLine(GetPrefabCatalog());
              }
          }

          userSb.AppendLine("## User Request");
          userSb.AppendLine(userPrompt);

          systemMessage = sysSb.ToString();
          // ... generate tools ...

          return userSb.ToString(); // Return formatted user message
      }

  # ============================================================================
  # 4. ACTIONS (SAVE PROMPT FILE)
  # ============================================================================

  actions:
    SavePromptFileAction:
      purpose: Execute savePromptFile tool calls from AI
      file: Actions/SavePromptFileAction.cs

      properties:
        - RelativePath: string (e.g., "Examples/Furniture/lamp_on_table.txt")
        - Content: string (full prompt file content)
        - Reason: string (explanation from AI)

      execute_logic: |
        1. Validate path security:
           - Reject if contains ".."
           - Reject if rooted path (C:\, /)
           - Require .txt extension

        2. Resolve full path:
           - Use PromptLibraryLoader.GetFullPath(RelativePath)

        3. Create directory if needed:
           - Extract directory path
           - Directory.CreateDirectory()

        4. Write file:
           - File.WriteAllText(fullPath, Content)
           - AssetDatabase.Refresh(ImportAssetOptions.Default)

        5. Auto-enable in settings:
           - PromptLibrarySettings.SetPromptEnabled(RelativePath, true)
           - Find PromptReference, set autoEnabled = true

        6. Return result:
           - Success: Include saved path in message
           - Failure: Include error details

      preview_mode: |
        - Log would-be file path and content preview
        - Do not actually write file
        - Return success with preview message

  # ============================================================================
  # 5. EXAMPLE MODE WORKFLOW
  # ============================================================================

  example_mode_workflow:
    overview: |
      AI-driven diagnostic and refinement workflow using tool calls.
      AI autonomously saves/updates files - no user "save" commands needed.

    step_1_create_new:
      user_action: Enter name → Click "Create New Example"
      flow: |
        1. User enters example name (e.g., "lamp_on_table")
        2. Click "Create New Example" button
        3. Window calls EnterExampleMode(null)
        4. Auto-enables: sls_detailed_guide.txt, example_generation_instructions.txt
        5. User describes scenario: "Show placing lamp on table using semantic alignment"
        6. AI generates example following instructions
        7. AI calls savePromptFile tool with content
        8. Window executes SavePromptFileAction
        9. File created at Examples/{category}/{name}.txt
        10. File auto-enabled in prompt library tree

    step_2_refine_existing:
      user_action: Select prompt → Click "Refine Selected Example"
      flow: |
        1. User selects existing example in tree (e.g., "lamp_on_table.txt")
        2. Click "Refine Selected Example" button
        3. Window calls EnterExampleMode(_selectedPromptPath)
        4. Auto-enables: sls_detailed_guide.txt, debug_guide.txt
        5. Window loads existing file content into conversation
        6. User reports issue: "The lamp is floating instead of on surface"
        7. AI analyzes using debug_guide.txt
        8. AI identifies problem (missing semantic alignment)
        9. AI generates corrected example
        10. AI calls savePromptFile tool with fixed content
        11. Window executes SavePromptFileAction (overwrites file)
        12. Updated file shown in preview pane

    step_3_exit:
      user_action: Click "Exit Example Mode" button
      behavior: |
        - Returns to Scene Builder mode
        - Auto-enables basic_instructions.txt
        - Auto-disables sls_detailed_guide.txt, example_generation_instructions.txt
        - Conversation state preserved (response ID maintained)

  # ============================================================================
  # 5. UNITY 6 COMPATIBILITY
  # ============================================================================

  unity6_compatibility:
    serialization:
      issue: Dictionaries not serialized by Unity (lost on domain reload)
      solution: Use List<ModeState> with [SerializeField]
      implementation: |
        [System.Serializable]
        public class ModeState
        {
            public WindowMode mode;
            public string responseId;
            public List<string> logs = new List<string>();
            public string prompt = "";
            public Vector2 scrollPosition;
        }

        [SerializeField] private List<ModeState> _modeStates = new List<ModeState>();
        [SerializeField] private bool _isExampleMode = false;

    asset_database:
      best_practice: Use explicit ImportAssetOptions
      implementation: |
        AssetDatabase.Refresh(ImportAssetOptions.Default);

    editor_window_lifecycle:
      pattern: Subscribe in OnEnable, unsubscribe in OnDisable
      implementation: |
        void OnEnable()
        {
            _settings = AIAssistantSettings.GetOrCreateSettings();
            _promptSettings = PromptLibrarySettings.GetOrCreateSettings();

            // Initialize mode states if empty
            if (_modeStates.Count == 0)
            {
                _modeStates.Add(new ModeState { mode = WindowMode.SceneBuilder });
                _modeStates.Add(new ModeState { mode = WindowMode.ExampleBuilder });
            }

            RefreshPromptList();
            EditorSceneManager.sceneSaved += OnSceneSaved;
        }

        void OnDisable()
        {
            EditorSceneManager.sceneSaved -= OnSceneSaved;
        }

  # ============================================================================
  # 6. IMPLEMENTATION PHASES
  # ============================================================================

  implementation_phases:
    total_hours: 18-22 hours

    phase_1_extract_prompts:
      hours: 2
      tasks:
        - Create PromptLibrary/Core/basic_instructions.txt (extract from ContextBuilder)
        - Create PromptLibrary/Core/example_generation_instructions.txt (new)
        - Create PromptLibrary/Diagnostics/debug_guide.txt (new)
        - Move SLS_MATH_README.md → PromptLibrary/Core/sls_detailed_guide.txt
        - Add autoEnabled field to PromptReference class
        - Modify ContextBuilder.BuildContextPack() to load from prompts
      validation:
        - Scene Builder works with basic_instructions.txt
        - Prompts load correctly
        - No regression in functionality

    phase_2_three_column_layout:
      hours: 5-6
      tasks:
        - Implement three-column layout (40% | 30% | 30%)
        - Add serializable state management (List<ModeState>)
        - Implement prompt library tree view with checkboxes
        - Implement preview pane (text-only display)
        - Add "Create New Example" and "Refine Selected" buttons
        - Add "Exit Example Mode" button (greyed by default)
        - Add context checkboxes (Send scene / Send prefabs)
      validation:
        - Three columns render correctly
        - Prompt library tree shows all prompts
        - Checkboxes enable/disable prompts
        - Selection shows preview
        - State survives domain reload

    phase_3_example_mode:
      hours: 8-10
      tasks:
        - Add savePromptFile tool to DynamicToolGenerator.cs (6th tool)
        - Create Actions/SavePromptFileAction.cs implementing IAction
        - Update DynamicPlanApplier.cs to parse savePromptFile tool calls
        - Implement EnterExampleMode() / OnExitExampleMode()
        - Implement auto-enable prompt logic (AutoEnableExampleModePrompts, AutoEnableSceneBuilderPrompts)
        - Add TryEnablePrompt() and TryDisablePrompt() helpers
        - Update OnCreateNewExample() to call EnterExampleMode(null)
        - Update OnRefineSelectedExample() to call EnterExampleMode(_selectedPromptPath)
        - Add SavePromptFileAction result handling in OnExecuteSelected()
        - Add path validation security checks in SavePromptFileAction
        - Create or rename debug_guide.txt file
      validation:
        - AI can call savePromptFile tool successfully
        - SavePromptFileAction creates files in correct directories
        - Path validation prevents directory traversal attacks
        - Files auto-enable in prompt library tree after save
        - Create New Example enters mode and AI generates content
        - Refine Selected loads existing content and AI fixes errors
        - Exit returns to Scene Builder with correct prompts enabled
        - State survives domain reload

    phase_4_context_integration:
      hours: 2
      tasks:
        - Update ContextBuilder.BuildContextPack() signature
        - Wire up context checkboxes to ContextBuilder
        - Verify includeSceneContext / includePrefabCatalog work
      validation:
        - Context toggles affect request size
        - Scene Builder works with toggles
        - Example Mode works with toggles

    phase_5_polish_testing:
      hours: 2
      tasks:
        - UI spacing and visual polish
        - Error handling edge cases
        - Documentation (README.md)
      validation:
        - All workflows tested end-to-end
        - State isolation verified

  # ============================================================================
  # 7. VALIDATION TESTS
  # ============================================================================

  validation_tests:
    state_persistence:
      test_1: Enter Example Mode, recompile scripts, verify state preserved
      test_2: Type prompt, recompile, verify prompt text preserved
      test_3: Mid-conversation domain reload preserves response ID

    scene_builder:
      test_1: Normal scene building conversation works
      test_2: Context toggles affect request size
      test_3: basic_instructions.txt enabled by default
      test_4: Multi-turn conversation continuity

    example_mode:
      test_1: |
        Create new example flow:
        - Enter name → Create button → Describe scenario
        - AI calls savePromptFile tool → File created
        - Verify file exists at correct path
        - Verify auto-enabled in tree
      test_2: |
        Refine existing example flow:
        - Select prompt → Refine button → Report error
        - AI diagnoses → Calls savePromptFile tool → File updated
        - Verify file content corrected
        - Verify preview pane shows update
      test_3: |
        Auto-enable prompts on enter:
        - Enter Example Mode → Verify sls_detailed_guide.txt enabled
        - Exit Example Mode → Verify basic_instructions.txt re-enabled
      test_4: |
        Path validation security:
        - AI attempts "../../../etc/passwd" → Action fails
        - AI attempts "C:\Windows\system32\file.txt" → Action fails
        - AI uses valid path "Examples/Furniture/test.txt" → Success
      test_5: |
        File overwrite handling:
        - AI saves to existing filename → File overwritten (no confirmation needed)
        - Original content replaced with new content
      test_6: |
        Exit restores Scene Builder state:
        - Example Mode → Exit → Verify Scene Builder prompts active
        - Response ID and logs preserved

    prompt_library:
      test_1: Tree shows all prompts
      test_2: Checkboxes persist
      test_3: Selection shows preview
      test_4: Refresh updates tree

files_summary:
  new_files:
    - Actions/SavePromptFileAction.cs (Phase 3 - NEW for tool-based workflow)
    - PromptLibrary/Core/basic_instructions.txt (Phase 1 - extracted from ContextBuilder)
    - PromptLibrary/Core/example_generation_instructions.txt (Phase 1)
    - PromptLibrary/Diagnostics/debug_guide.txt (Phase 3 - create or rename from analyze_error.txt)
    - PromptLibrary/README.md (documentation)

  moved_files:
    - SLS_MATH_README.md → PromptLibrary/Core/sls_detailed_guide.txt (Phase 1)

  modified_files:
    - AIAssistantWindow.cs (Phase 2 & 3 - three columns + Example Mode + serialization)
    - DynamicToolGenerator.cs (Phase 3 - add 6th tool: savePromptFile)
    - DynamicPlanApplier.cs (Phase 3 - parse savePromptFile tool calls)
    - ContextBuilder.cs (Phase 1 - prompt-based system messages)
    - PromptLibrarySettings.cs (Phase 1 - add autoEnabled field)

  unchanged_files:
    - PromptLibraryLoader.cs ✓
    - PromptLibraryEditor.cs ✓ (keep as standalone alternative)
    - OpenAIClient.cs ✓
    - All existing example .txt files ✓

notes:
  key_design_decisions: |
    1. Three-column layout (not mode tabs) - all functionality visible at once
    2. Temporary Example Mode (modal) - not a persistent mode, auto-exits on completion
    3. Prompt-based system messages - all instructions in editable .txt files
    4. Unity 6 serialization - List<ModeState> survives domain reloads
    5. Single conversation - one chat log shared between Scene Builder and Example Mode
    6. Tool-based file saving - AI directly calls savePromptFile tool (NOT user commands)

  why_three_columns: |
    Three-column layout keeps all functionality accessible without mode switching.
    Users can see the prompt library, create examples, and preview content
    simultaneously. This is more efficient than tabbed or modal interfaces.

  why_temporary_example_mode: |
    Example Mode is a focused workflow: enter → create/refine → save → exit.
    Making it modal (temporary) prevents users from accidentally mixing
    example creation with scene building conversations. The "Exit Example Mode"
    button provides clear affordance for returning to normal operation.

  why_prompt_based_instructions: |
    Hardcoded instructions in ContextBuilder.cs are invisible to users and
    require code recompilation to modify. Moving instructions to .txt files
    makes them discoverable, editable, and version-controllable. Users can
    create custom instruction sets without touching code.

  why_tool_based_saving: |
    AI-driven workflow is more powerful than user-typed commands:
    - AI can autonomously diagnose and fix errors without user intervention
    - No parsing ambiguity ("save as X in Y" vs "save to X.txt" vs other variants)
    - AI provides structured 'reason' field explaining each change
    - Enables batch corrections (AI could potentially fix multiple related examples)
    - Better UX: user describes problem → AI analyzes → AI fixes → file saved automatically
    - Tool call provides strong typing and validation (relativePath, content, reason)
    - Eliminates need for ExtractExampleFromConversation() heuristics

    Example:
    User: "The lamp example is wrong, it's floating"
    AI: *Analyzes with debug_guide.txt → Identifies missing semantic alignment*
    AI: *Calls savePromptFile("Examples/Furniture/lamp_on_table.txt", corrected_content, "Fixed floating lamp by using semantic bottom→top alignment")*
    Window: *Executes action → File saved → User sees update*
